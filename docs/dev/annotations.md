# Annotations

The rules defined in the `cgiar-reader` grammars are run over annotated text, which is generated by a [`Processor`](https://github.com/clulab/processors/blob/master/main/src/main/scala/org/clulab/processors/Processor.scala) to produce an annotated [`Document`](https://github.com/clulab/processors/blob/master/main/src/main/scala/org/clulab/processors/Document.scala) instance that can be serialized to JSON. Example JSON output for the text "How many TEUs of Frozen Meat are heading to Hamburg?" can be found in [this Github Gist](https://gist.github.com/zwellington/21688441b3d8a62f8e2f2051e1792a63).

## Processors

Currently there are three processors avalaible to the REST API: `Custom`, `CluProcessor`, and `ProxiedProcessor`. 

### `CustomProcessor`
The `Custom` processor uses a mixture of components from the [`clulab/processors`](https://github.com/lum-ai/cgiar-reader/blob/master/reader/src/main/scala/ai/lum/mr/cgiar/processors/CustomProcessor.scala) library with custom pre- and post-processing hooks.  

### `CluProcessor` 
`CluProcessor` comes directly from [`clulab/processors`](https://github.com/clulab/processors/blob/master/main/src/main/resources/cluprocessor.conf). 

### `ProxiedProcessor`

The `ProxiedProcessor` performs annotation via REST calls and allowing the user to easily mix components written in different programming languages.  The `ProxiedProcessor` is defined in [`reader/src/main/scala/ai/lum/mr/processors`](https://github.com/lum-ai/cgiar-reader/blob/master/reader/src/main/scala/ai/lum/mr/processors/ProxiedProcessor.scala). One can use [SpaCy](https://spacy.io/) for annotation via the [`clu-spacy` library](https://github.com/clu-ling/clu-spacy)).

## Lexicon NER

The Lexicon NER allows you to specify many strings that should be given a certain Named Entity label which can help downstream processes recognize entities. To add new strings (or edit existing ones), follow these steps.

1. Create a new file or edit the strings in the TSVs under the [`reader/src/main/resources/ai/lum/kb/raw/`](https://github.com/lum-ai/cgiar-reader/blob/master/reader/src/main/resources/ai/lum/kb/raw) folder. The TSVs are of the format <string to match> TAB <grounded entity>. 
2. If you add a new file, update the [`cgiar.tsv`](https://github.com/lum-ai/cgiar-reader/blob/lexiconNer/reader/src/main/resources/ai/lum/kb/cgiar.tsv) record to reflect what NE label the strings beneath should be assigned. Update `ai.lum.mr.ner.kbs` in [`reference.conf`](https://github.com/lum-ai/cgiar-reader/blob/lexiconNer/reader/src/main/resources/reference.conf) with the path where the new KB will be.  
3. Run `sbt "reader/runMain ai.lum.mr.cgiar.ner.CustomKbGenerator"` to bundle the TSVs into a format the LexiconNER can use.
4. Create rules that make reference to the `entity` field (e.g. using `[entity=/Crop/]` and assign an appropriate taxonomy label (being sure to update taxonomy.yml).
